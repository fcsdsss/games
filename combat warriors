local repo = "https://raw.githubusercontent.com/deividcomsono/Obsidian/main/"
local Library = loadstring(game:HttpGet(repo .. "Library.lua"))()

local Players = game:GetService("Players")
local Toggles = Library.Toggles

local Window = Library:CreateWindow({
	Title = "Combat Warriors Pro",
	Footer = "逐一添加功能...",
	Icon = 95816097006870,
})

local Tabs = {
	Combat = Window:AddTab("战斗", "swords"),
}

local CombatMelee = Tabs.Combat:AddLeftGroupbox("近战功能", "sword")

CombatMelee:AddToggle("hitboxExpander", {
	Text = "扩大武器判定框 (Hitbox)",
	Tooltip = "让你更容易击中敌人。需要重置角色才能恢复。",
	Default = false, 
	Callback = function(Value)
		if Value then
			Library:Notify("判定框已扩大", "请重置你的角色以恢复默认大小。")
			-- 遍历玩家角色中的所有工具
			for i, v in pairs(Players.LocalPlayer.Character:GetChildren()) do
				if v:IsA("Tool") and v:FindFirstChild("Hitboxes") and v.Hitboxes:FindFirstChild("Hitbox") then
					-- 遍历工具判定框中的所有伤害点
					for i2, v2 in pairs(v.Hitboxes.Hitbox:GetChildren()) do
						if v2:IsA("Attachment") and v2.Name == "DmgPoint" then
							-- 将伤害点的位置向上移动，从而扩大判定范围
							v2.Position = v2.Position + Vector3.new(0, 3, 0)
						end
					end
				end
			end
		end
	end,
})


CombatMelee:AddToggle("noParryCooldown", {
	Text = "无格挡冷却",
	Tooltip = "移除格挡后的等待时间，可以无限格挡。",
	Default = false,
	Callback = function(Value)
		for i, v in pairs(getgc(true)) do
			if type(v) == "table" and rawget(v, "PARRY_COOLDOWN_IN_SECONDS") and rawget(v, "PARRY_COOLDOWN_IN_SECONDS_AFTER_SUCCESSFUL_PARRY") then
				if Value then
					v.PARRY_COOLDOWN_IN_SECONDS = 0
					v.PARRY_COOLDOWN_IN_SECONDS_AFTER_SUCCESSFUL_PARRY = 0
				else
					v.PARRY_COOLDOWN_IN_SECONDS = 3
					v.PARRY_COOLDOWN_IN_SECONDS_AFTER_SUCCESSFUL_PARRY = 0.33
				end
			end
		end
	end,
})

CombatMelee:AddDivider()


local MenuGroup = Tabs.Combat:AddRightGroupbox("菜单设置", "wrench")
MenuGroup:AddLabel("菜单开关按键"):AddKeyPicker("MenuKeybind", { Default = "RightShift", NoUI = true, Text = "菜单按键" })
Library.ToggleKeybind = Library.Options.MenuKeybind
